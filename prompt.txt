# ğŸ§  Telegram Among Us Bot (Core + Full Feature Set)

Build a Telegram group game bot inspired by Among Us. The bot supports 4â€“20 players per match, using inline button and DM commands to perform actions. Games occur in group chats (ranked/unranked), and all gameplay is driven via **DM for private interactions**.

The bot must use the following stack:

* `python-telegram-bot v20+`
* `asyncio`
* `asyncpg` for PostgreSQL
* `dotenv`
* `pydantic`
* `structlog` for structured logging

---

## ğŸ§© Game Structure Summary

### âœ… Game Modes

* Ranked Mode:

  * Allowed only in groups listed via `.env` (`RANKED_GC_IDS`)
  * Defaults to ranked if no parameter passed in these groups
  * `/startgame unranked` can override

* Unranked Mode:

  * Default for all other groups
  * Ranked cannot be started in unlisted groups

---

## ğŸ“¦ Basic Commands

| Command     | Scope    | Description                                                                      |
| ----------- | -------- | -------------------------------------------------------------------------------- |
| `/start`    | Anywhere | Registers player with bot                                                        |
| `/help`     | DM only  | Help guide. If used in group, bot replies with redirect to DM and passes command |
| `/info`     | DM only  | Game info. Same redirect logic as `/help`                                        |
| `/ping`     | Anywhere | Checks bot responsiveness                                                        |
| `/about`    | DM only  | Bot/repo/dev info. Same redirect logic as /help                                  |
| `/report`   | DM only  | Report a bug. Same redirect logic as /help                                       |
| `/feedback` | DM only  | Send suggestions. Same redirect logic as /help                                   |
| `/roles`    | DM only  | List of roles. Same redirect logic as /help                                      |
| `/rules`    | DM only  | Game rule summary. Same redirect logic as /help                                  |

* Command Prefix Flexibility: All commands can be triggered with `/`, `!`, `?`, `.`

---

## ğŸ” Admin & Owner Commands

| Command                      | Who Can Use                 | Description                                               |
| ---------------------------- | --------------------------- | --------------------------------------------------------- |
| `/xban <user_id> <duration>` | Bot Owner only              | Bans user from ranked games for a duration or permanently |
| `/xunban <user_id>`          | Bot Owner only              | Unbans user                                               |
| `/setxp <user_id> <amount>`  | Bot Owner only              | Adjusts user XP                                           |
| `/end`                       | Group admin or game creator | Force-ends an ongoing game in that group                  |

> Ban durations: h, d, m, `perma` (hours, days, months, permanent)

---

## ğŸ§  Game Flow

### ğŸ” Phases

1. Lobby Phase (starts after `/startgame`, 60s)
2. Night Phase (60s)
3. Day Phase (90s discussion + 30s voting)
4. Back to Night (until win/lose)

---

## ğŸ”· Lobby Phase

* `/startgame` creates a new lobby in a group (if one isnâ€™t already active)
* Players use `/join` to join
* Bot sends a confirmation message in dm of joined player and updates the player list in same message in that group
* Players must have initiated a DM with bot to participate (due to Telegram restrictions)
* Lobby Message: shows updated player list in group as inline message
* 60-second timeout

  * If 4+ players join: game starts automatically
  * If <4: game cancels

    * Quiet message in group, DMs to joined players
* `/begin`: game creator can force start early if players >= 4
* `/end`: ends lobby/game manually

---

## ğŸ­ Role Assignment (Randomized)

Based on total players:

| Player Count | Roles                                                            |
| ------------ | ---------------------------------------------------------------- |
| 4â€“8          | 1 Impostor, 1 Detective, rest Crewmates                          |
| 9â€“12         | 2 Impostors, 1 Detective, rest Crewmates                         |
| 13â€“16        | 3 Impostors, 2 Detectives, 1 Sheriff, 1 Engineer, rest Crewmates |
| 17â€“20        | 4 Impostors, 2 Detectives, 1 Sheriff, 1 Engineer, rest Crewmates |

* Roles are secret and sent via DM
* Impostors (if â‰¥2) and detectives (if 2) know each other and can chat via botâ€™s DM channel
* 5s delay, then Night Phase begins

---

## ğŸŒ™ Night Phase (60 Seconds)

* Bot announces in group: â€œğŸŒ™ Night phase has started! Go to DM to perform your actions.â€ (inline button link)
* Every role acts in DM
* After 60s:

  * All actions are evaluated
  * Players who didnâ€™t act are counted as AFK

### ğŸ›  Actions Per Role

| Role      | Action                                           |
| --------- | ------------------------------------------------ |
| Crewmate  | Completes tasks (from predefined task pool)      |
| Impostor  | Votes on kill target (or solo kill if 1 imp)     |
| Detective | Investigates player (see conditions below)       |
| Sheriff   | Kills a player (see conditions below)            |
| Engineer  | Gets a prompt if the previous round failed tasks |

#### Crewmate Task Distribution

| Players | Tasks Given To    |
| ------- | ----------------- |
| 4â€“8     | 1 random crewmate |
| 9â€“12    | 2                 |
| 13â€“16   | 3                 |
| 17â€“20   | 4                 |

> If even 1 assigned crewmate fails â†’ round is marked incomplete

#### Impostor Logic

* Solo impostor: selects target and kills
* 2+ impostors: vote in DM, can chat

  * Most-voted player dies
  * Ties/no vote â†’ no one dies
* If impostors reduce to 1 â†’ DM chat is closed

#### Sheriff Logic

 * Can shoot one player per game (if not used in one night phase if can be used in next night phase)
 * If target is an imposter
    
   * Imposter dies, sheriff earns +1 shot(can be used in next phase)
   * Imposter name and role reveals in following day phase
   * Sheriff remains anonymous
 
 * If target is a crewmate

   * Sheriff dies, targeted crewmate dies.
   * Both names, roles, cause of death revealed in the following day phase

#### Detective Logic

* If 1 detective â†’ investigate every 2 rounds
* If 2 detectives â†’ investigate every round

  * Must both pick the same player
  * If mismatch â†’ investigation skipped
  * Investigation reveals: "Impostor" or "Not Impostor"
  * If one dies, other continue to investigate daily and DM chat is closed

#### Engineer

* When a failed round occurs:

  * Gets DM prompt during Day Phase with:

    * â€œFix the ship?â€ (fix it/skip buttons)
    * 30s to decide

  * Can fix only once per game
  * If skipped or ignored â†’ failure counts

---

## â˜€ï¸ Day Phase (120 Seconds Total)

1. Start (0s):

   * Group message:

     * Alive players list
     * Night summary:

       * Deaths (player name, cause, role)
       * Task result: completed or failed
       * Sheriff kill result (only reveals imposter if correct)

2. Discussion (90s):

   * Players talk in group
   * Bot does nothing

3. Voting (30s):

   * Bot announces: â€œğŸ—³ Voting has begun. Go to DM.â€
   * Each alive player:

     * Votes privately in DM (list of alive players)
     * May choose â€œSkip voteâ€
     * Once voted, bot posts: â€œâœ… PlayerName has voted.â€ (anonymous vote)
   * After time:

     * Most-voted player is ejected
     * Their name, role revealed
     * Tie or no vote â†’ no ejection

---

## ğŸ’¥ Game End Conditions

### ğŸŸ¢ Crewmate Win

* All impostors are dead (via vote or sheriff kill)

### ğŸ”´ Impostor Win

* Alive impostors â‰¥ alive non-impostors (including specials)

### âš« Ship Explosion (Everyone Loses)

* 2 failed task rounds (not necessarily in a row)
* Engineer either:

  * Has already used ability
  * OR fails to respond in time
* Bot posts: â€œğŸ’¥ Ship exploded. Everyone loses.â€

---

## ğŸ“š Task Pool (Examples)

Used for crewmate tasks (DM buttons):

* â€œAlign navigation â†’ Confirmâ€
* â€œDivert power â†’ Flip switchâ€
* â€œFuel engines â†’ Tap fuel buttonâ€
* â€œEmpty garbage â†’ Press to open chuteâ€
* â€œStart reactor â†’ Pattern matchingâ€

> Tasks must be designed for 1-click confirmation via inline buttons.

---

## ğŸ§  XP System

### âœ… XP Rewards

| Event                       | XP  |
| --------------------------- | --- |
| Win                         | +25 |
| Loss                        | +5  |
| Task completed              | +3  |
| Correct vote                | +2  |
| Impostor kill (as impostor) | +5  |
| Sheriff kills impostor      | +10 |
| Detective finds impostor    | +8  |
| Engineer saves ship         | +15 |

### âŒ XP Penalties

| Event                   | XP  |
| ----------------------- | --- |
| Ship explodes           | -15 |
| Friendly fire (sheriff) | -10 |
| Missed vote/task (AFK)  | -5  |

### ğŸ” Streak Bonus

* Each consecutive win increases XP bonus:

  * +3 XP per additional win
  * Resets on loss or AFK

---

## ğŸ… Achievements

Triggered by unique player actions:

| Achievement            | Trigger                        |
| ---------------------- | ------------------------------ |
| First win              | Win 1 game                     |
| 10 Tasks Completed     | Complete 10 tasks              |
| Sheriff Clutch         | Kill impostor, win game        |
| Engineer Save          | Fix ship successfully          |
| Detective Streak       | 3 impostors found in 3 games   |
| Perfect Crewmate Round | Tasks + vote correct + survive |

* Stored in DB
* DM announcement when unlocked

---

## ğŸ—ƒï¸ PostgreSQL Tables (Outline)

* `users`: id, xp, is\_banned, ban\_expiry, streak, achievements
* `games`: id, mode, group\_id, phase, start\_time, end\_time
* `players`: game\_id, user\_id, role, is\_alive, voted, completed\_task
* `bans`: user\_id, start\_time, duration, reason
* `achievements`: user\_id, flags (booleans or enum list)

---

## ğŸªµ Logging (structlog)

Log all:

* Phase transitions
* Role assignments
* Kills, votes, task results
* Admin actions
* XP changes
* Achievement unlocks
* Errors (timeouts, mismatched state, DM issues)

---

## âœ… Final Notes

* All interactions respect Telegram limits
* Inline buttons guide user to botâ€™s DM where needed
* Game state and role visibility is **strictly isolated**
* No spectators, appeals, or leaderboards (by request)
* Every detail here is based on confirmed user input

Perfectâ€”hereâ€™s the final **note** and updated **folder structure** based on everything you've specified:

---

## ğŸ“ Developer Note

* All XP values, achievements, task definations, and log messages provided in this project are examples and can be customized freely
* XP System is can be hardcoded inside the logic for simplicity, but the values can be tweaked easily
* Task pool is stored in a separate python module to allow easy expansion and inline button integration
* Achievements are stored in separate file, so new milestones can be added anytime
* Every game details should be logged in game log channel like a new game is started by a user in particular group then it logs a new game started by this user in this group along with group link and after the game finishes then it logs that the game ended with winners details and time duration of the game (no need to log every single detail just game start game end and winners as well as all the players name) 
* Every time a new user starts the bot or user gets banned or unbanned are logged in bot log channel
* Logs and inline comments are intentionally styles in a sarcastic, Among-us themed tone for maximum sass and readability.
   * Example: Sheriff just rage-clicked an innocent. RIP trust issues ğŸ’€ğŸ”«


---

## ğŸ“ Final Folder Structure

amongus/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ bot/
â”‚   â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”‚   â”œâ”€â”€ commands.py
â”‚   â”‚   â”‚   â”œâ”€â”€ admin.py
â”‚   â”‚   â”‚   â””â”€â”€ callbacks.py
â”‚   â”‚   â”œâ”€â”€ bot_instance.py
â”‚   â”‚   â””â”€â”€ dispatcher.py
â”‚   â”œâ”€â”€ game/
â”‚   â”‚   â”œâ”€â”€ game_state.py
â”‚   â”‚   â”œâ”€â”€ phase_manager.py
â”‚   â”‚   â”œâ”€â”€ role_factory.py
â”‚   â”‚   â”œâ”€â”€ win_conditions.py
â”‚   â”‚   â”œâ”€â”€ task_engine.py
â”‚   â”‚   â””â”€â”€ task_pool.py   
â”‚   â”œâ”€â”€ roles/
â”‚   â”‚   â”œâ”€â”€ base_role.py
â”‚   â”‚   â”œâ”€â”€ crewmate.py
â”‚   â”‚   â”œâ”€â”€ impostor.py
â”‚   â”‚   â”œâ”€â”€ detective.py
â”‚   â”‚   â”œâ”€â”€ sheriff.py
â”‚   â”‚   â””â”€â”€ engineer.py
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”œâ”€â”€ models.py
â”‚   â”‚   â””â”€â”€ connection.py
â”‚   â”œâ”€â”€ systems/
â”‚   â”‚   â”œâ”€â”€ xp_system.py
â”‚   â”‚   â”œâ”€â”€ ban_system.py
â”‚   â”‚   â”œâ”€â”€ achievement_system.py
â”‚   â”‚   â”œâ”€â”€ achievements.py     
â”‚   â”‚   â””â”€â”€ logger.py
â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”œâ”€â”€ keyboards.py
â”‚   â”‚   â””â”€â”€ messages.py
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â””â”€â”€ constants.py
â”‚   â””â”€â”€ main.py
â”œâ”€â”€ .env.example
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
```

---